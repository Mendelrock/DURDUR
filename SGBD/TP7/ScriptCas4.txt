SET LINESIZE 150

REM ------------------------------------
REM Cas 4 TRIGGERS : DENORMALISATION
REM ------------------------------------


DROP TABLE FOURNISSEUR CASCADE CONSTRAINT PURGE
/
CREATE TABLE FOURNISSEUR 
(IdFourn INTEGER CONSTRAINT PK_FOURN PRIMARY KEY,
NomFOurn VARCHAR(30)
)
/

DROP TABLE PRODUIT CASCADE CONSTRAINT PURGE
/
CREATE TABLE PRODUIT
(IdProd INTEGER CONSTRAINT PK_PRODUIT PRIMARY KEY,
LibelleProd VARCHAR(30),
PrixProd NUMBER(10,2),
REf_IdFourn INTEGER CONSTRAINT FK_PROD_FOURN REFERENCES FOURNISSEUR(IdFourn)
)
/

-- On ajoute la colonne Nom du fournisseur dans la table produit pour limiter les jointures.

ALTER TABLE PRODUIT ADD NomFOURN VARCHAR(30)
/


INSERT INTO FOURNISSEUR (IdFourn, NomFOURN) VALUES (1,'Fourn1');
INSERT INTO FOURNISSEUR (IdFourn, NomFOURN) VALUES (2,'Fourn2');
INSERT INTO FOURNISSEUR (IdFourn, NomFOURN) VALUES (3,'Fourn3');


CREATE OR REPLACE PROCEDURE INSERTPRODUIT (Pid INT, PLib VARCHAR, PPrix NUMBER, PIdF INT)
AS
BEGIN
INSERT INTO PRODUIT (IdProd, LibelleProd, PrixProd, Ref_IdFourn) VALUES (Pid, Plib, PPrix, PIdf);
END;
/
SHOW ERR

-- Ajout de produits

EXEC INSERTPRODUIT(2,'Coca',13,2);
EXEC INSERTPRODUIT(3,'Twix',2,3);

SELECT * FROM Produit;
